@model IEnumerable<TransportFleetManagementSystem.Model.Vehicle>
@{
	ViewData["Title"] = "Vehicle Management Dashboard";
}
<!--Links for Stylings-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


<!--Links for the Map-->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
	body{
		color:#000046;
	}
	.card {
		border: none;
		border-radius: 10px;
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		background-size: 1.5rem;
		font-weight: bold;
		border-bottom: none;
	}

	.card-body {
		padding: 1rem;
		font-size: 1rem;
		font-weight: bold;
	}

	.media {
		align-items: center;
	}

	.media-body {
		text-align: right;
	}

	.icon {
		font-size: 2.25rem;
		color: #000046; /* Set the color of all icons to #000046 */
	}


	#map {
		height: 350px;
		width: 100%;
	}
</style>

<div class="container">
	<div class="row">
		<div class="col-md-8">
			<div class="row">
				<!-- Vehicle Statistics Cards -->
				<div class="row mt-4">
					<div class="col-xl-4 col-sm-6 col-12 mb-3">
						<div class="card">
							<div class="card-content">
								<div class="card-body">
									<div class="media d-flex">
										<div class="align-self-center">
											<i class="fas fa-check-circle icon"></i>
										</div>
										<div class="media-body text-right">
											<h3>@ViewBag.LiveVehicles</h3>
											<span>Active</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-sm-6 col-12 mb-3">
						<div class="card">
							<div class="card-content">
								<div class="card-body">
									<div class="media d-flex">
										<div class="align-self-center">
											<i class="fas fa-times-circle icon"></i>
										</div>
										<div class="media-body text-right">
											<h3>@ViewBag.Inactive</h3>
											<span>Inactive</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-sm-6 col-12 mb-3">
						<div class="card">
							<div class="card-content">
								<div class="card-body">
									<div class="media d-flex">
										<div class="align-self-center">
											<i class="fas fa-exclamation-circle icon"></i>
										</div>
										<div class="media-body text-right">
											<h3>@ViewBag.Maintenance</h3>
											<span>Maintenance</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				
				</div>
				<!-- Vehicle Statistics Cards -->
				<div class="row mt-3">
					<div class="col-xl-6 col-sm-12 col-12">
						<div class="card">
							<div class="card-content">
								<div class="card-body">
									<div class="media d-flex align-items-center">
										<i class="fas fa-car-side icon"></i>
										<div class="media-body text-right ml-2">
											<h3>@ViewBag.Cars</h3>
											<span>Cars</span>
										</div>
									</div>
									<div class="media d-flex align-items-center mt-3">
										<i class="fas fa-shuttle-van icon"></i>
										<div class="media-body text-right ml-2">
											<h3>@ViewBag.Minivans</h3>
											<span>Mini Vans</span>
										</div>
									</div>
									<div class="media d-flex align-items-center mt-3">
										<i class="fas fa-bus-alt icon"></i>
										<div class="media-body text-right ml-2">
											<h3>@ViewBag.Buses</h3>
											<span>Buses</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Service Due and Overdue Card -->
					<div class="col-xl-6 col-sm-12 col-12">
						<div class="card">
							<div class="card-content">
								<div class="card-body">
									<div class="media d-flex">
										<div class="align-self-center">
											<i class="fas fa-tools icon"></i>
										</div>
										<div class="media-body text-right">
											<h3>@ViewBag.ServiceDue</h3>
											<span>Service Due</span>
										</div>
									</div>
									<div class="media d-flex mt-3">
										<div class="align-self-center">
											<i class="fas fa-exclamation-triangle icon"></i>
										</div>
										<div class="media-body text-right">
											<h3>@ViewBag.ServiceOverdue</h3>
											<span>Service Overdue</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<!-- Map View -->
		<div class="col-md-4 mt-2">
			<div id="map" class="mb-5"></div>
		</div>
	</div>



	<!--Buttons to Add and Modify Vehicle Data-->
	<div class="row mt-2">
		<div class="col-md-12 d-flex justify-content-start">
			<a class="btn  font-weight-bold mr-2" style="background-color:#000046 ; color:white " asp-action="Create"> + Add New Vehicle </a>
		</div>
	</div>

	<div class="table-responsive mt-2">
		<table class="table table-hover table-bordered">
			<thead class="thead" style="background-color:#000046 ; color:white ">
				<tr>
					<th class="col-3">Registration Number</th>
					<th class="col-2">Capacity</th>
					<th class="col-2">Status</th>
					<th class="col-2">Last Service Date</th>
					<th class="col-2">Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
					{
					<tr>
						<td>@item.RegistrationNumber</td>
						<td>@item.Capacity</td>
						<td>@item.Status</td>
						<td>@item.LastServicedDate.ToString("dd-MM-yyyy")</td>
						<td>
							<a class="btn btn-sm" class="btn btn-sm" style="background-color: transparent; border: 2px solid #000046; color: #000046;" asp-action="Details" asp-route-id="@item.VehicleId"><i class="fas fa-eye"></i></a>
							<a class="btn btn-sm" class="btn btn-sm" style="background-color: transparent; border: 2px solid #000046; color: #000046;" asp-action="Edit" asp-route-id="@item.VehicleId"><i class="fas fa-edit"></i></a>
							<a class="btn btn-sm" class="btn btn-sm" style="background-color: transparent; border: 2px solid #000046; color: #000046;" asp-action="Delete" asp-route-id="@item.VehicleId" id="deleteVehicleModal"><i class="fas fa-trash"></i></a>
						</td>
					</tr>
					}
			</tbody>
		</table>
	</div>
</div>



<!--Script for Map-->
<script>
	var map = L.map('map').setView([13.0827, 80.2707], 15);

	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(map);

	var activeIcon = L.icon({
		iconUrl: 'https://cdn-icons-png.flaticon.com/512/7080/7080248.png',
		iconSize: [25, 25]
	});

	var inactiveIcon = L.icon({
		iconUrl: 'https://tse4.mm.bing.net/th/id/OIP.haL7GzASA-JmeH0f_5qcYQHaHa?rs=1&pid=ImgDetMain',
		iconSize: [25, 25]
	});

	var maintenanceIcon = L.icon({
		iconUrl: 'https://cdn0.iconfinder.com/data/icons/transport-111/66/5-128.png',
		iconSize: [25, 25]
	});

	var vehicles = [
		{ registrationNumber: 'TN 01 AA 1234', location: [13.0825, 80.2707], status: 'Active', icon: activeIcon },
		{ registrationNumber: 'TN 01 AA 1235', location: [13.0630, 80.2710], status: 'Active', icon: activeIcon },
		{ registrationNumber: 'TN 01 AA 1236', location: [13.0835, 80.2713], status: 'Active', icon: activeIcon },
		{ registrationNumber: 'TN 01 BB 5678', location: [13.0740, 80.2716], status: 'Inactive', icon: inactiveIcon },
		{ registrationNumber: 'TN 01 BB 5679', location: [13.0845, 80.2719], status: 'Inactive', icon: inactiveIcon },
		{ registrationNumber: 'TN 01 CC 9101', location: [13.0832, 80.2722], status: 'Maintenance', icon: maintenanceIcon }
	];

	function getRandomCoordinates(bbox) {
		var lat = bbox[0] + (Math.random() * (bbox[2] - bbox[0]));
		var lng = bbox[1] + (Math.random() * (bbox[3] - bbox[1]));
		return [lat, lng];
	}

	var boundingBox = [13.0600, 80.2600, 13.1000, 80.2800]; // Define your bounding box here

	function addVehicle(registrationNumber, status) {
		var location = getRandomCoordinates(boundingBox);
		var icon;
		if (status === 'Active') {
			icon = activeIcon;
		} else if (status === 'Inactive') {
			icon = inactiveIcon;
		} else if (status === 'Maintenance') {
			icon = maintenanceIcon;
		}
		var vehicle = { registrationNumber: registrationNumber, location: location, status: status, icon: icon };
		vehicles.push(vehicle);
		var marker = L.marker(vehicle.location, { icon: vehicle.icon }).addTo(map);
		marker.bindPopup(`<b>${vehicle.registrationNumber}</b><br>Status: ${vehicle.status}`);
	}

	vehicles.forEach(function(vehicle) {
		var marker = L.marker(vehicle.location, { icon: vehicle.icon }).addTo(map);
		marker.bindPopup(`<b>${vehicle.registrationNumber}</b><br>Status: ${vehicle.status}`);
	});

	// Example of adding a new vehicle
	addVehicle('TN 01 DD 1122', 'Active');
</script>

<!--Bootstarp Links for Stylings and Responsive Design-->

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

